<!--pages/index/index.wxml-->
<view class="container">
  <!-- å¤´éƒ¨ -->
  <view class="detail-metrics" style="width: 589rpx; display: block; box-sizing: border-box; position: relative; left: 77rpx; top: 0rpx">
    <view class="header-content">
      <text class="title">ğŸ‘” æ™¾è¡£åŠ©æ‰‹</text>
      <text class="subtitle">æ™ºèƒ½å¤©æ°”æ™¾è¡£å»ºè®®</text>
    </view>
  </view>

  <!-- ä½ç½®ä¿¡æ¯ -->
  <view class="card" wx:if="{{location}}" style="width: 589rpx; display: flex; box-sizing: border-box">
    <view class="location-info">
      <text class="location-icon">ğŸ“</text>
      <view class="location-details">
        <text class="location-text">{{location.address}}</text>
        <text class="location-coords">çº¬åº¦: {{location.lat.toFixed(4)}} ç»åº¦: {{location.lon.toFixed(4)}}</text>
      </view>
    </view>
    <view class="location-actions">
      <button class="btn-small" bindtap="getLocation">åˆ·æ–°ä½ç½®</button>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading" wx:if="{{loading}}">
    <view class="spinner"></view>
    <text class="loading-text">æ­£åœ¨è·å–å¤©æ°”æ•°æ®...</text>
  </view>

  <!-- é”™è¯¯ä¿¡æ¯ -->
  <view class="error-card" wx:if="{{error}}">
    <text class="error-icon">âŒ</text>
    <text class="error-text">{{error}}</text>
    <button class="btn-primary" bindtap="retryFetch">é‡è¯•</button>
  </view>

  <!-- ä»Šæ—¥å»ºè®® -->
  <view class="card" wx:if="{{todayForecast && todayForecast.avg_temp !== undefined}}">
    <view class="today-header">
      <text class="today-title">ä»Šæ—¥æ™¾è¡£å»ºè®®</text>
      <text class="today-date">{{todayForecast.dateDisplay}}</text>
    </view>
    
    <view class="recommendation {{todayForecast.color}}">
      <text class="recommendation-text">{{todayForecast.recommendation}}</text>
      <text class="drying-index">æ™¾è¡£æŒ‡æ•°: {{todayForecast.drying_index_display || '0'}}/100</text>
    </view>

    <!-- è¿›åº¦æ¡ -->
    <view class="progress-container">
      <view class="progress-bar {{todayForecast.color}}" style="width: {{todayForecast.drying_index}};"></view>
    </view>

    <!-- æŒ‡æ ‡ç½‘æ ¼ -->
    <view class="metric-grid">
      <view class="metric-item" style="width: 650rpx; display: block; box-sizing: border-box">
        <text class="metric-label">ğŸŒ¡ï¸ æ¸©åº¦</text>
        <text class="metric-value">{{todayForecast.avg_temp_display || '--'}}Â°C</text>
        
      </view>
      <view class="metric-item" style="width: 650rpx; display: block; box-sizing: border-box">
        <text class="metric-label">ğŸ’§ æ¹¿åº¦</text>
        <text class="metric-value">{{todayForecast.avg_humidity_display || '--'}}%</text>
        <text class="metric-desc" wx:if="{{todayForecast.avg_humidity < 40}}">å¹²ç‡¥</text>
        <text class="metric-desc" wx:elif="{{todayForecast.avg_humidity < 70}}">èˆ’é€‚</text>
        <text class="metric-desc" wx:else>æ½®æ¹¿</text>
      </view>
      <view class="metric-item" style="width: 650rpx; display: block; box-sizing: border-box">
        <text class="metric-label">ğŸ’¨ é£é€Ÿ</text>
        <text class="metric-value">{{todayForecast.avg_wind_display || '--'}}km/h</text>
        <text class="metric-desc" wx:if="{{todayForecast.avg_wind < 5}}">å¾®é£</text>
        <text class="metric-desc" wx:elif="{{todayForecast.avg_wind < 15}}">å’Œé£</text>
        <text class="metric-desc" wx:else>å¼ºé£</text>
      </view>
      <view class="metric-item" style="width: 650rpx; display: block; box-sizing: border-box">
        <text class="metric-label">â˜” é™é›¨</text>
        <text class="metric-value">{{todayForecast.rain_probability_display || '0'}}%</text>
        <text class="metric-desc" wx:if="{{todayForecast.rain_probability < 30}}">æ— é›¨</text>
        <text class="metric-desc" wx:elif="{{todayForecast.rain_probability < 60}}">å¯èƒ½</text>
        <text class="metric-desc" wx:else>æœ‰é›¨</text>
      </view>
    </view>

    <!-- è¯¦ç»†æŒ‡æ ‡ -->
    <view class="detail-metrics" wx:if="{{todayForecast}}">
      <view class="detail-item">
        <text class="detail-label">ğŸŒ¥ï¸ äº‘é‡</text>
        <text class="detail-value">{{todayForecast.avg_cloud_cover_display || '--'}}%</text>
      </view>
      <view class="detail-item">
        <text class="detail-label">ğŸ’¦ æ€»é™é›¨</text>
        <text class="detail-value">{{todayForecast.total_precipitation_display || '0.0'}}mm</text>
      </view>
      <view class="detail-item">
        <text class="detail-label">ğŸŒ¬ï¸ å¹²ç‡¥åº¦</text>
        <text class="detail-value">{{todayForecast.avg_vpd_display || '--'}}kPa</text>
      </view>
    </view>

    <!-- é™é›¨æé†’ -->
    <view class="rain-alert" wx:if="{{todayForecast.rain_alert}}">
      <text class="alert-icon">âš ï¸</text>
      <text class="alert-text">å·¥ä½œæ—¶é—´é¢„è®¡æœ‰é›¨ï¼è¯·æå‰æ”¶è¡£æœ</text>
    </view>
  </view>

  <!-- æ“ä½œæŒ‰é’® -->
  <view class="action-buttons">
    <button class="btn-primary" bindtap="getLocation" style="width: 308rpx; display: flex; box-sizing: border-box; left: 0rpx; top: 6rpx; position: relative">
      <text class="btn-icon">ğŸ“</text>
      <text>è·å–ä½ç½®</text>
    </button>
    
    <button class="btn-primary" bindtap="fetchWeather" wx:if="{{location}}" style="width: 308rpx; display: flex; box-sizing: border-box; left: 2rpx; top: 2rpx; position: relative">
      <text class="btn-icon">ğŸŒ¤ï¸</text>
      <text>è·å–å¤©æ°”</text>
    </button>
    
    <button class="btn-outline" bindtap="goToForecast" wx:if="{{forecasts.length > 0}}" style="position: ; left: 0rpx; top: 2rpx">
      <text class="btn-icon">ğŸ“…</text>
      <text>æŸ¥çœ‹5å¤©é¢„æŠ¥</text>
    </button>
    
    <button class="btn-outline" bindtap="goToSettings" style="width: 308rpx; display: flex; box-sizing: border-box; left: 0rpx; top: 0rpx; height: 122rpx">
      <text class="btn-icon">âš™ï¸</text>
      <text>ä¸ªæ€§åŒ–è®¾ç½®</text>
    </button>
  </view>

  <!-- å°è´´å£« -->
  <view class="card tips-card">
    <text class="tips-title">ğŸ’¡ æ™¾è¡£å°è´´å£«</text>
    <view class="tips-content">
      <text>â€¢ ğŸŸ¢ æŒ‡æ•°â‰¥60: é€‚åˆæ™¾æ™’æ‰€æœ‰è¡£ç‰©</text>
      <text>â€¢ ğŸŸ¡ æŒ‡æ•°30-60: é€‚åˆå¿«å¹²è¡£ç‰©</text>
      <text>â€¢ ğŸ”´ æŒ‡æ•°å°äº30: å»ºè®®å®¤å†…æ™¾å¹²</text>
    </view>
  </view>
</view>