<!--pages/forecast/forecast.wxml-->
<view class="container">
  <!-- å¤´éƒ¨ -->
  <view class="header">
    <view class="header-content">
      <text class="title">ğŸ“… 5å¤©é¢„æŠ¥</text>
      <text class="subtitle">æœªæ¥5å¤©æ™¾è¡£å»ºè®®</text>
    </view>
  </view>

  <!-- æ—¥å†è§†å›¾ -->
  <view class="card">
    <view class="section-title">
      <text class="section-icon">ğŸ“Š</text>
      <text class="section-text">æ™¾è¡£æ—¥å†</text>
    </view>
    
    <view class="calendar-view">
      <view 
        class="calendar-item {{item.color}}" 
        wx:for="{{forecasts}}" 
        wx:key="index"
        bindtap="showForecastDetail"
        data-index="{{index}}"
      >
        <view class="calendar-info">
          <text class="calendar-date">{{item.dateDisplay}}</text>
          <text class="calendar-recommendation">{{item.recommendation}}</text>
        </view>
        <view class="calendar-value">
          <text class="drying-index">{{item.drying_index.toFixed(0)}}/100</text>
        </view>
      </view>
    </view>
    
    <!-- å›¾ä¾‹ -->
    <view class="legend">
      <view class="legend-item">
        <view class="legend-color green"></view>
        <text class="legend-text">é€‚åˆæ™¾è¡£ (â‰¥60)</text>
      </view>
      <view class="legend-item">
        <view class="legend-color orange"></view>
        <text class="legend-text">è°¨æ…æ™¾è¡£ (30-60)</text>
      </view>
      <view class="legend-item">
        <view class="legend-color red"></view>
        <text class="legend-text">ä¸é€‚åˆ (å°äº30)</text>
      </view>
    </view>
  </view>

  <!-- è¯¦ç»†é¢„æŠ¥ -->
  <view class="card" wx:if="{{currentForecast}}">
    <view class="section-title">
      <text class="section-icon">ğŸ“ˆ</text>
      <text class="section-text">{{currentForecast.dateDisplay}} è¯¦ç»†åˆ†æ</text>
    </view>
    
    <!-- æ¨èçŠ¶æ€ -->
    <view class="recommendation {{currentForecast.color}}">
      <text class="recommendation-text">{{currentForecast.recommendation}}</text>
      <text class="drying-index">æ™¾è¡£æŒ‡æ•°: {{currentForecast.drying_index.toFixed(0)}}/100</text>
    </view>

    <!-- è¿›åº¦æ¡ -->
    <view class="progress-container">
      <view class="progress-bar {{currentForecast.color}}" style="width: {{currentForecast.drying_index}};"></view>
    </view>

    <!-- å¤©æ°”æŒ‡æ ‡ -->
    <view class="metric-grid">
      <view class="metric-item">
        <text class="metric-label">ğŸŒ¡ï¸ æ¸©åº¦</text>
        <text class="metric-value">{{currentForecast.avg_temp.toFixed(1)}}Â°C</text>
        <text class="metric-range">{{currentForecast.min_temp.toFixed(0)}}Â°-{{currentForecast.max_temp.toFixed(0)}}Â°</text>
      </view>
      <view class="metric-item">
        <text class="metric-label">ğŸ’§ æ¹¿åº¦</text>
        <text class="metric-value">{{currentForecast.avg_humidity.toFixed(0)}}%</text>
      </view>
      <view class="metric-item">
        <text class="metric-label">ğŸ’¨ é£é€Ÿ</text>
        <text class="metric-value">{{currentForecast.avg_wind.toFixed(1)}}km/h</text>
      </view>
      <view class="metric-item">
        <text class="metric-label">â˜” é™é›¨</text>
        <text class="metric-value">{{currentForecast.rain_probability.toFixed(0)}}%</text>
      </view>
    </view>

    <!-- è¯¦ç»†æ•°æ® -->
    <view class="detail-section">
      <view class="detail-item">
        <text class="detail-label">äº‘é‡è¦†ç›–</text>
        <text class="detail-value">{{currentForecast.avg_cloud_cover.toFixed(0)}}%</text>
      </view>
      <view class="detail-item">
        <text class="detail-label">é¥±å’Œæ°´æ±½å‹å·®</text>
        <text class="detail-value">{{currentForecast.avg_vpd.toFixed(2)}} kPa</text>
      </view>
      <view class="detail-item">
        <text class="detail-label">æ€»é™æ°´é‡</text>
        <text class="detail-value">{{currentForecast.total_precipitation.toFixed(1)}} mm</text>
      </view>
    </view>

    <!-- é™é›¨æé†’ -->
    <view class="rain-alert" wx:if="{{currentForecast.rain_alert}}">
      <text class="alert-icon">âš ï¸</text>
      <text class="alert-text">å·¥ä½œæ—¶é—´é¢„è®¡æœ‰é›¨ï¼è¯·æå‰æ”¶è¡£æœ</text>
    </view>

    <!-- å·¥ä½œæ—¶é—´åˆ†æ -->
    <view class="work-hour-analysis" wx:if="{{currentForecast.work_hour_data.length > 0}}">
      <text class="analysis-title">å·¥ä½œæ—¶é—´æ®µåˆ†æ</text>
      <view class="analysis-content">
        <text>â€¢ æ¸©åº¦èŒƒå›´: {{getWorkHourTempRange(currentForecast.work_hour_data)}}Â°C</text>
        <text>â€¢ æ¹¿åº¦èŒƒå›´: {{getWorkHourHumidityRange(currentForecast.work_hour_data)}}%</text>
        <text>â€¢ æœ€å¤§é™é›¨æ¦‚ç‡: {{getMaxRainProb(currentForecast.work_hour_data)}}%</text>
      </view>
    </view>
  </view>

  <!-- æ“ä½œæŒ‰é’® -->
  <view class="action-buttons">
    <button class="btn-primary" bindtap="exportReport">
      <text class="btn-icon">ğŸ“„</text>
      <text>å¯¼å‡ºæŠ¥å‘Š</text>
    </button>
    <button class="btn-outline" bindtap="goBack">
      <text class="btn-icon">â¬…ï¸</text>
      <text>è¿”å›é¦–é¡µ</text>
    </button>
  </view>
</view>